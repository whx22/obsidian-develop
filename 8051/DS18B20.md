---
aliases:
  - DS18B20温度传感器
tags:
  - 51单片机
  - c
  - DS18B20
summary: 
create time: 2023-12-20T20:43:00
modify time:
---
## DS18B20原理

[DS18B20中文](./attachments/DS18B20中文)

DS18B20 是由 DALLAS 半导体公司推出的一种的==“一线总线（单总线）”==接口的温度传感器。与传统的热敏电阻等测温元件相比，它是一种新型的体积小、适用电压宽、与微处理器接口简单==数字化==温度传感器。

1. 测温范围：-55摄氏度到+125摄氏度
2. 通信接口：1-wire
3. 其他特性：可形成总线结构、内置温度报警功能、可寄生供电（不使用VCC口，使用DQ口供电）

### 引脚及应用电路

![[Pasted image 20231220223207.png]]

### 内部结构框图

![[Pasted image 20231220224932.png]]

![[Pasted image 20231220230209.png]]

#### 存储器结构

![[Pasted image 20231220230321.png]]

![[Pasted image 20231221213026.png]]

## 单总线

一根数据线：DQ(Data Queue)

异步、半双工

单总线只需要一根通信线即可实现数据的双向传输，当采用寄生供电时，可以省去设备的VDD线路，此时，供电加通信只需要DQ和GND两根线。

### 电路规范

1. 设备的DQ需要配置成开漏输出模式（总线可挂载多设备，实现多机通行）
2. DQ添加一个上拉电阻，阻值一般为4.7千欧左右
3. 若此总线的从机采用寄生供电，则主机还需要配置一个强上拉输出电路

![[Pasted image 20231220233130.png]]

### 时序结构

#### 初始化时序

单总线上的所有通信都是以初始化序列开始。主机输出低电平，保持低电平时间至少 480us（该时间的时间范围可以从 480 到 960 微妙），以产生复位脉冲。
接着主机释放总线，外部的上拉电阻将单总线拉高，延时 15～60 us，并进入接收模式。
接着 DS18B20 拉低总线 60~240 us，以产生低电平应答脉冲，若为低电平，还要做延时，其延时的时间从外部上拉电阻将单总线拉高算起最少要480 微妙。

![[Pasted image 20231221212911.png]]

#### 主机向从机发送1bit数据时序

写时序包括写 0 时序和写 1 时序。所有写时序至少需要 ==60us==，且在 2 次独立的写时序之间至少需要 1us 的恢复时间，两种写时序均起始于主机拉低总线。

写 1 时序：主机输出低电平，延时 2us，然后释放总线，延时 60us。

写 0时序：主机输出低电平，延时 60us，然后释放总线，延时 2us。

![[Pasted image 20231221213911.png]]

#### 主机向从机接受1bit数据时序

单总线器件仅在主机发出读时序时，才向主机传输数据，所以，在主机发出读数据命令后，必须马上产生读时序，以便从机能够传输数据。

所有读时序至少需要 ==60us==，且在 2 次独立的读时序之间至少需要 1us 的恢复时间。

每个读时序都由主机发起，至少拉低总线 1us。

主机在读时序期间必须释放总线，并且在时序起始后的 15us 之内采样总线状态。

![[Pasted image 20231221214444.png]]

#### 主机向从机发送1Byte数据时序

连续调用8次发送一位的时序，依次发送一个字节的8位（==低位在前==，I2C总线为高位在前）

#### 主机向从机接受1Byte数据时序

连续调用8次接受一位的时序，依次接受一个字节的8位（==低位在前==，I2C总线为高位在前）

### DS18B20操作流程

1. 初始化：从机复位，主机判断从机是否响应
2. ROM操作：ROM指令 + 本指令需要进行的读写操作
3. 功能操作：功能指令 + 本指令需要进行的读写操作

![[Pasted image 20231221220127.png]]

#### ROM指令流程图

![[Pasted image 20231221225211.png]]

#### 功能指令流程图

![[Pasted image 20231221225305.png]]

### DS18B20数据帧

#### 温度变换

DS18B20芯片内部将==温度数据模拟量==转化为==温度数据数字量==，并写到内部RAM

![[Pasted image 20231221223207.png]]

#### 温度读取

主机读取DS18B20芯片RAM

![[Pasted image 20231221223345.png]]

##### 温度存储格式

![[Pasted image 20231221223738.png]]

- ! 以补码形式表示

![[Pasted image 20231221223802.png]]

## 代码

### DS18B20温度读取

### DS18B20温度报警器

